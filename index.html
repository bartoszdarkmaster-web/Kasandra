<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>KASSANDRA – Strategic Early Warning System</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ef4444">

<!-- Leaflet -->
<link rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
body {
  margin: 0;
  background: #0b0f17;
  color: #e5e7eb;
  font-family: system-ui, -apple-system, Segoe UI, Roboto;
}
header {
  padding: 16px;
  border-bottom: 1px solid #1f2937;
}
h1 {
  margin: 0;
  font-size: 20px;
}
main {
  padding: 16px;
  max-width: 1100px;
  margin: auto;
}
.card {
  background: #121826;
  border: 1px solid #1f2937;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 16px;
}
.risk {
  font-size: 42px;
  font-weight: 800;
  color: #ef4444;
}
.scale {
  height: 10px;
  background: linear-gradient(90deg,#22c55e,#f59e0b,#ef4444);
  border-radius: 6px;
  margin: 10px 0;
  position: relative;
}
.marker {
  position: absolute;
  top: -4px;
  width: 4px;
  height: 18px;
  background: #fff;
}
button {
  background: #1f2937;
  color: #e5e7eb;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
}
button:hover {
  background: #374151;
}
#map {
  height: 450px;
  border-radius: 12px;
}
</style>
</head>

<body>

<header>
  <h1>KASSANDRA – Strategic Early Warning System</h1>
</header>

<main>

<!-- DECISION MODE -->
<div class="card">
  <div class="risk" id="riskLevel">HIGH</div>
  <div class="scale">
    <div class="marker" id="riskMarker"></div>
  </div>
  <div>
    CEPI: <b id="cepi">0.00</b>
  </div>
  <br>
  <button onclick="updateNow()">UPDATE NOW</button>
</div>

<!-- MAPA -->
<div class="card">
  <div id="map"></div>
</div>

</main>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===== DANE ===== */
const events = [
  { title:"Koncentracja wojsk", category:"military", delta:0.04, confidence:0.88, lat:53.9, lon:27.56 },
  { title:"Transporty paliwa", category:"logistics", delta:0.03, confidence:0.82, lat:47.9, lon:37.8 },
  { title:"Szpital polowy", category:"medical", delta:0.02, confidence:0.80, lat:51.5, lon:31.3 }
];

const weights = { military:0.2, logistics:0.25, medical:0.2 };

/* ===== MAPA ===== */
const map = L.map("map").setView([20,0],2);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 6,
  attribution: "© OpenStreetMap"
}).addTo(map);

const layers = {
  military: L.layerGroup().addTo(map),
  logistics: L.layerGroup().addTo(map),
  medical: L.layerGroup().addTo(map)
};

function color(cat) {
  return cat === "military" ? "#ef4444"
       : cat === "logistics" ? "#f59e0b"
       : "#22c55e";
}

/* ===== CEPI ===== */
function calcCEPI() {
  let sum = 0;
  events.forEach(e => {
    sum += e.delta * (weights[e.category] || 0.1) * e.confidence;
  });
  document.getElementById("cepi").innerText = sum.toFixed(2);
  document.getElementById("riskMarker").style.left = (sum * 100) + "%";
}

/* ===== MAPA ===== */
function renderMap() {
  Object.values(layers).forEach(l => l.clearLayers());

  events.forEach(e => {
    const m = L.circleMarker([e.lat, e.lon], {
      radius: 8 + e.delta * 120,
      color: color(e.category),
      fillColor: color(e.category),
      fillOpacity: 0.85
    }).bindPopup(`<b>${e.title}</b><br>Δ ${e.delta}`);

    layers[e.category].addLayer(m);
  });
}

/* ===== UPDATE ===== */
function updateNow() {
  calcCEPI();
  renderMap();
}

updateNow();
setTimeout(() => map.invalidateSize(), 300);
</script>

</body>
</html>
